const ccxt = require("ccxt");
const _ = require("lodash");

class ExchangeDataCCXT
{
    constructor() {

    }

    async getCandles(exchangeId, symbol, interval, since, candlesCount) {
        
        // Setup the integration to the exchange
        const exchangeClass = ccxt[exchangeId];
        const exchange = new exchangeClass();

        // Fetch the candles from the exchange
        let candles = await exchange.fetchOHLCV(symbol, interval, since, candlesCount);

        // Zip up the candle fields in the format that TAAPI.IO takes
        let candleFields = [
            'timestamp', // This is in microseconds, not miliseconds
            'open',
            'high',
            'low',
            'close',
            'volume',
        ];

        //candles = candles.map(candle => _.zipObject(candleFields, candle));
        candles = candles.map(candle => _.zipObject(candleFields, candle));

        return candles;
    }
}

module.exports = ExchangeDataCCXT;